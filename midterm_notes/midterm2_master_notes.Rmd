---
title: "Midterm 2 Master Notes"
author: "Lejla Becirevic"
date: "2024-02-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(skimr)
library(naniar)
library(visdat)
``` 

## LAB 8

**summarize() and group_by() are powerful tools that we can use to produce clean summaries of data. Especially when used together, we can quickly group variables of interest and save time**
```{r}
?penguins
```

**Produce a summary of the mean for bill_length_mm, bill_depth_mm, flipper_length_mm, and body_mass_g within Adelie penguins only. Be sure to provide the number of samples**
```{r}
penguins %>% 
  filter(species=="Adelie") %>% 
  summarize(mean_bill_length=mean(bill_length_mm, na.rm = T),
            mean_bill_depth=mean(bill_depth_mm, na.rm = T),
            mean_flippper_length=mean(flipper_length_mm, na.rm = T),
            mean_body_mass=mean(body_mass_g, na.rm = T),
            n=n())
```

### across()
**Function in dplyr called `across()` which can count for multiple variables**

**Use `summarize()` to produce distinct counts over multiple variables; i.e. species, island, and sex?** 
```{r}
penguins %>%
  summarize(distinct_species = n_distinct(species),
            distinct_island = n_distinct(island),
            distinct_sex = n_distinct(sex))
```

**By using `across()` we can reduce the clutter and make things cleaner**
```{r}
penguins %>%
  summarize(across(c(species, island, sex), n_distinct))
```

**This is very helpful for continuous variables**
```{r}
penguins %>%
  summarize(across(contains("mm"), mean, na.rm=T))
```

**group_by also works**
```{r}
penguins %>%
  group_by(sex) %>% 
  summarize(across(contains("mm"), mean, na.rm=T))
```

**Here we summarize across all variables**
```{r}
penguins %>%
  summarise_all(n_distinct)
```

**Operators can also work, here I am summarizing n_distinct() across all variables except species, island, and sex**
```{r}
penguins %>%
  summarize(across(!c(species, island, sex, year), 
                   mean, na.rm=T))
```

**All variables that include "bill"...all of the other dplyr operators also work**
```{r}
penguins %>%
  summarise(across(starts_with("bill"), n_distinct))
```

**Produce separate summaries of the mean and standard deviation for bill_length_mm, bill_depth_mm, and flipper_length_mm for each penguin species. Be sure to provide the number of samples**
```{r}
penguins %>% 
  group_by(species) %>% 
  summarise(across(c(contains("mm"), body_mass_g), mean, na.rm=T), #included variable after contains "mm" with the c() function, can also add stuff after
            n=n())
```

**Load the mammals life history data and clean the names**
```{r}
life_history <- read_csv("data/mammal_lifehistories_v3.csv") %>% clean_names()
```

**Here is a new one for you using the `purrr` package. This will give you a quick summary of the number of NA's in each variable.**
```{r}
life_history %>% 
  map_df(~ sum(is.na(.)))
```

**A single approach to deal with NA's in this data set**
```{r}
life_history <- read_csv("data/mammal_lifehistories_v3.csv", na= c("NA", " ", ".", "-999", "not measured")) %>% clean_names() # you nee to know how the NAs are represented in the data; you dont want to do this by default
```

### naniar
**naniar is a package that is built to manage NA's**

**miss_var_summary provides a clean summary of NA's across the data frame**
```{r}
naniar::miss_var_summary(life_history)
```

**Let's use mutate() and na_if() to replace 0's with NA's**
```{r}
life_history <- 
  life_history %>% 
  mutate(max_life=na_if(max_life, 0))
```

**We can also use `miss_var_summary` with `group_by()`. This helps us better evaluate where NA's are in the data.**
```{r}
life_history %>%
  group_by(order) %>%
  select(order, wean_mass) %>% 
  miss_var_summary(order=T)
```

**naniar also has a nice replace function which will allow you to precisely control which values you want replaced with NA's in each variable.**
```{r}
life_history %>% 
  replace_with_na(replace = list(newborn = "not measured", 
                                 weaning= -999, 
                                 wean_mass= -999, 
                                 afr= -999, 
                                 max_life= 0, 
                                 litter_size= -999, 
                                 gestation= -999, 
                                 mass= -999)) %>% 
miss_var_summary() #makes replacement of NAs specific with variable
```

**Import the data and do a little exploration. Be sure to clean the names if necessary.
```{r}
cites <- read_csv("data/cites.csv") %>% clean_names()
```

**Try using `group_by()` with `naniar`. Look specifically at class and `exporter_reported_quantity`. For which taxonomic classes do we have a high proportion of missing export data?**
```{r}
cites %>% 
  select(class, exporter_reported_quantity) %>% 
  group_by(class) %>%
  miss_var_summary() %>% 
  arrange(desc(pct_miss))
```

### Visualizing NAs
```{r}
vis_dat(life_history) #classes of data
```

```{r}
vis_miss(life_history)
```

### Dealing with NA's in advance
**If you are sure that you know how NA's are treated in the data, then you can deal with them in advance using `na()` as part of the `readr` package.**
```{r}
life_history_advance <- 
  readr::read_csv(file = "data/mammal_lifehistories_v3.csv", 
                  na = c("NA", " ", ".", "-999")) #all NA, blank spaces, .,and -999 are treated as NA
```


## LAB 9


